<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	    <!-- Bootstrap CSS -->
	    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
	    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"  media="screen">
	    
		<title>FitsOnTheWeb</title>
		
		<meta http-equiv="content-type" content="text/html; charset=windows-1252">
		
		<link rel="stylesheet" type="text/css" href="style.css">
		
		<script src="ColorMaps.js"></script>
		<script src="FITSOnTheWeb.js"></script>
		<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
		<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
		
		
		<script>
		
			var reader;
		
			function handleChange(myRadio){

				let postcard = document.getElementById("postcard"+myRadio.id).value;
				
				let min = parseFloat(document.getElementById("min"+myRadio.id).value);
				let max = parseFloat(document.getElementById("max"+myRadio.id).value);
				
// 				alert("min "+min+" max "+max);
				
				let cme = document.getElementById("colorMaps");
				let colorMap = cme.options[cme.selectedIndex].value;
				
				let tfe = document.getElementById("scaleFunction");
				let tFunction = tfe.options[tfe.selectedIndex].value;
				
				document.getElementById('imgDiv').innerHTML = "nothing!";
// 				reader = new FabFitsReader(myRadio.value, colorMap, tFunction, 0.0966, 2.461, function (img) {
				reader = new FabFitsReader(myRadio.value, colorMap, tFunction, min, max, function (img) {
					document.getElementById('imgDiv').innerHTML = "<img src="+img.src+">";
					
					var slidermin = document.getElementById ("range-min");
					slidermin.setAttribute ("min", reader.min);
					slidermin.setAttribute ("max", reader.max);
					slidermin.setAttribute ("value", reader.min);
					
// 					alert("reader.min "+reader.min+" reader.max "+reader.max);
					
					var slidermax = document.getElementById ("range-max");
					slidermax.setAttribute ("min", reader.min);
					slidermax.setAttribute ("max", reader.max);
					slidermax.setAttribute ("value", reader.max);
					
// 					alert("reader.min "+reader.min+" reader.max "+reader.max);
				});
				document.getElementById('postcardDiv').innerHTML = "<img src="+postcard+">";
				
			
				
			}
		
			function changeColorMap() {
				
				let e = document.getElementById("colorMaps");
				let strUser = e.options[e.selectedIndex].value;
				
				let inverse = document.getElementById("inverse").checked;

				reader.applyColorMap(strUser, inverse);
				document.getElementById('imgDiv').innerHTML = "<img src="+reader.img.src+">";
			}
		
			function changeScaleFunction(){
				let e = document.getElementById("scaleFunction");
				let strUser = e.options[e.selectedIndex].value;
				
				if (strUser.startsWith("-")){
					alert("Sorry, functionality not implemented yet.");
				}else{
					reader.applyScaleFunction(strUser);
					document.getElementById('imgDiv').innerHTML = "<img src="+reader.img.src+">";	
				}
				
				
			}
			
			function loadFromURL(){
		
				let cme = document.getElementById("colorMaps");
				let colorMap = cme.options[cme.selectedIndex].value;
				
				let tfe = document.getElementById("scaleFunction");
				let tFunction = tfe.options[tfe.selectedIndex].value;
				
				
				let url = document.getElementById('url').value;
				
				document.getElementById('imgDiv').innerHTML = "nothing!";
				reader = new FabFitsReader(url, colorMap, tFunction, null, null, function (img) {
					document.getElementById('imgDiv').innerHTML = "<img src="+img.src+">";
				});
			
			}
			
			var isDragging = true;

			var r1 = document.getElementById("range-min");
			var r2 = document.getElementById("range-max");
			
			document.addEventListener('mousedown', e => {
				isDragging = true;
			});
			
			
			document.addEventListener('mouseup', e => {
				isDragging = false;
			});
			
			
			let r1_val;
			let r2_val;
			
			function checkMinMax(){
				
				let r1_val = document.getElementById("range-min").value;
				let r2_val = document.getElementById("range-max").value;
				let min = Math.min(r1_val, r2_val);
				let max = Math.max(r1_val, r2_val);
				reader.min = min;
				reader.max = max;

			}
		
			function reprocess(){
				
				let r1_val = document.getElementById("range-min").value;
				let r2_val = document.getElementById("range-max").value;
				let min = Math.min(r1_val, r2_val);
				let max = Math.max(r1_val, r2_val);

				reader.readPayload (min, max);
				document.getElementById('imgDiv').innerHTML = "<img src="+reader.img.src+">";

			}
		</script>
		
	</head>
<body>

    
	<div id="container">
		
		<div>
			<label for="colorMaps">Choose a color map:</label>
		
			<select name="colorMaps" id="colorMaps" class="colorMaps" onchange="changeColorMap()">
			    <option value="grayscale">Grayscale</option>
			    <option value="planck">Planck</option>
			    <option value="eosb">EOSB</option>
			    <option value="rainbow">Rainbow</option>
			    <option value="cmb">CMB</option>
			    <option value="cubehelix">Cubehelix</option>
			</select>
		
			<input type="checkbox" id="inverse" name="inverse" onchange="changeColorMap()">
			<label for="inverse">Inverse</label><br>
		</div>
		<br>
		<div>
			<label for="scaleFunction">Choose a scale function:</label>
		
			<select name="scaleFunction" id="scaleFunction" class="scaleFunction" onchange="changeScaleFunction()">
			    <option value="linear">linear</option>
			    <option value="log">log</option>
			    <option value="-power">-power-</option>
			    <option value="sqrt">sqrt</option>
			    <option value="-squared">-squared-</option>
			    <option value="-asinh">-asinh-</option>
			    <option value="-sinh">-sinh-</option>
			    <option value="-histogram">-histogram-</option>
			</select>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<select name="scaleFunction" id="scaleFunction" class="scaleFunction" onchange="changeScaleFunction()">
			    <option value="minmax">minmax</option>
			    <option value="-zscale">-zscale-</option>
			</select>
		</div>
		<br>
		
		<label for="testest">Pixels scale:<br>
			<i style="color:red">
				N.B.: small bug in the UI: labels Min and Max not updating the first time the FITS gets loaded.
				<br>This doesn't affect the real values computation. 
				<br>Once the sliders are dragged, the Min and Max labels get updated.
			</i>
		</label>
		<div id="testest">
			<div data-role="main" class="ui-content">
				<div data-role="rangeslider">
					<label for="range-min">Min:</label>
					<input type="range" name="range-min" id="range-min" value="0" min="0" max="100" step="0.0001" onchange="checkMinMax();" />
					<label for="range-max">Max:</label>
					<input type="range" name="range-max" id="range-max" value="100" min="0" max="100" step="0.0001" onchange="checkMinMax();" />
				</div>
				<input type="button" name="minmax" id="minmax" value="go" onclick="reprocess();" />
			</div>
		</div>
		<br>
		
		
		
		
		<div id="result">
			
			
			<div class="prevCard">
				<label for='imgDiv'>
					computed image from FITS:
				</label>
				<div id='imgDiv'>
				</div>
			</div>
			
			<div class="prevCard">
				<label for='postcardDiv'>
					Postcard (if any):
				</label>
				<div id='postcardDiv'>
				</div>
			</div>
		
		</div>
		
		
		


		
		
		<div id="samples" >
			<div class="sampleCard">
				<label for='url'>Try to load any FITS from a URL. Supported FITS at the moment are STSCI standard FITS twos-complement binary integer and IEEE single precision floating point. 
				<br> In case you find an unsupported FITS, pls send an email to fgiordano(at)sciops.esa.int with the URL of the FITS. 
				<br> FITS URL: </label>
				<input type='text' name='url' id='url' size='100'/>
				<input type='button' name='urlButton' onclick="loadFromURL();" value='go'/>
			</div>
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='1' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/lfi-070-smooth/Npix293.fits'>
				<input type='hidden' name='postcard1' id='postcard1' value='http://skies.esac.esa.int/pla/LFI_SkyMap_070_1024_R3_00_full_smooth_HiPS/Norder3/Dir0/Npix293.png'/>
				Min: <input type='text' name='min1' value=0 id='min1'/>
				Max: <input type='text' name='max1' value=3.5 id='max1'/>
				<label for='1'>
					FITS from HiPS: Planck lfi-070-smooth sample 1
				</label>
				http://skies.esac.esa.int/pla/LFI_SkyMap_070_1024_R3_00_full_smooth_HiPS/Norder3/Dir0/Npix293.png
				<br>http://skies.esac.esa.int/pla/LFI_SkyMap_070_1024_R3_00_full_smooth_HiPS/Norder3/Dir0/Npix293.fits
			</div>
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='2' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/lfi-070-smooth/Npix304.fits'>
				<input type='hidden' name='postcard2' id='postcard2' value='http://skies.esac.esa.int/pla/LFI_SkyMap_070_1024_R3_00_full_smooth_HiPS/Norder3/Dir0/Npix304.png'/>
				Min: <input type='text' name='min2' value=0 id='min2'/>
				Max: <input type='text' name='max2' value=3.5 id='max2'/>
				<label for='2'>
					FITS from HiPS: Planck lfi-070-smooth sample 2
				</label>
				http://skies.esac.esa.int/pla/LFI_SkyMap_070_1024_R3_00_full_smooth_HiPS/Norder3/Dir0/Npix304.png
				<br>http://skies.esac.esa.int/pla/LFI_SkyMap_070_1024_R3_00_full_smooth_HiPS/Norder3/Dir0/Npix304.fits
			</div>
			
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='3' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/herschel/spire250norm/Npix278.fits'>
				<input type='hidden' name='postcard3' id='postcard3' value='http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix278.png'/>
				Min: <input type='text' name='min3' value=0.0966 id='min3'/>
				Max: <input type='text' name='max3' value=2.461 id='max3'/>
				<label for='3'>
					FITS from HiPS: Herschel hips250_pnorm_allsky sample 1
				</label>
				http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix278.png
				<br>http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix278.fits
			</div>
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='4' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/herschel/spire250norm/Npix281.fits'>
				<input type='hidden' name='postcard4' id='postcard4' value='http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix281.png'/>
				Min: <input type='text' name='min4' value=0.0966 id='min4'/>
				Max: <input type='text' name='max4' value=2.461 id='max4'/>
				<label for='4'>
					FITS from HiPS: Herschel hips250_pnorm_allsky sample 2
				</label>
				http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix281.png
				<br>http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix281.fits
			</div>
			
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='5' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/herschel/spire250norm/Npix282.fits'>
				<input type='hidden' name='postcard5' id='postcard5' value='http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix282.png'/>
				Min: <input type='text' name='min5' value=0.0966 id='min5'/>
				Max: <input type='text' name='max5' value=2.461 id='max5'/>
				<label for='5'>
					FITS from HiPS: Herschel hips250_pnorm_allsky sample 3
				</label>
				http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix282.png
				<br>http://skies.esac.esa.int/Herschel/normalized/hips250_pnorm_allsky/Norder3/Dir0/Npix282.fits
			</div>
			
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='6' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/unknown/Npix19.fits'>
				<input type='hidden' name='postcard6' id='postcard6' value=''/>
				Min: <input type='text' name='min6' value=null id='min6'/>
				Max: <input type='text' name='max6' value=null id='max6'/>
				<label for='6'>
					FITS from HiPS: Planck unknown sample 1 (npix31/norder3)
				</label>
			</div>
				
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='7' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/unknown/Npix31.fits'>
				<input type='hidden' name='postcard7' id='postcard7' value=''/>
				Min: <input type='text' name='min7' value=null id='min7'/>
				Max: <input type='text' name='max7' value=null id='max7'/>
				<label for='7'>
					FITS from HiPS: Planck unknown sample 2 (npix31/norder3)
				</label>
			</div>
				
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='8' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/unknown/Npix237.fits'>
				<input type='hidden' name='postcard8' id='postcard8' value=''/>
				Min: <input type='text' name='min8' value=null id='min8'/>
				Max: <input type='text' name='max8' value=null id='max8'/>
				<label for='8'>
					Planck unknown sample 3 (npix237/norder3) taken from:
					<br>I don't know! Somewhere from ESASky eheh
				</label>
			</div>
			
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='9' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/unknown/Npix259.fits'>
				<input type='hidden' name='postcard9' id='postcard9' value=''/>
				Min: <input type='text' name='min9' value=null id='min9'/>
				Max: <input type='text' name='max9' value=null id='max9'/>
				<label for='9'>
					FITS from HiPS: Planck unknown sample 4 (npix259/norder3)
				</label>
			</div>

			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='10' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/unknown/Npix356.fits'>
				<input type='hidden' name='postcard10' id='postcard10' value=''/>
				Min: <input type='text' name='min10' value=null id='min10'/>
				Max: <input type='text' name='max10' value=null id='max10'/>
				<label for='10'>
					FITS from HiPS: Planck unknown sample 5 (npix356/norder3)
				</label>
			</div>
			
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='11' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/planck/unknown/Npix416.fits'>
				<input type='hidden' name='postcard11' id='postcard11' value=''/>
				Min: <input type='text' name='min11' value=null id='min11'/>
				Max: <input type='text' name='max11' value=null id='max11'/>
				<label for='11'>
					Planck unknown sample 5 (npix416/norder3) taken from:
					<br>I don't know! Somewhere from ESASky eheh
				</label>
			</div>
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='12' value='http://localhost/~lavorofab/javascript/FITSOnTheWeb/input/FITS/hst/x0c70103t_c1f.fits'>
				<input type='hidden' name='postcard12' id='postcard12' value='http://hst.esac.esa.int/ehst-sl-server/servlet/data-action?RETRIEVAL_TYPE=POSTCARD&OBSERVATION_ID=x0c70103t'/>
				Min: <input type='text' name='min12' value=null id='min12'/>
				Max: <input type='text' name='max12' value=null id='max12'/>
				<label for='12'>
					HST sample1 (normal FITS, no HiPS) taken from the eHST archive. Observation x0c70103t
				</label>
				http://hst.esac.esa.int/ehst-sl-server/servlet/data-action?RETRIEVAL_TYPE=POSTCARD&OBSERVATION_ID=x0c70103t
			</div>
			
			<div class="sampleCard">
				<input type='radio' name='fits' onclick="handleChange(this);" id='13' value='input/FITS/hst/w1000403t_c0f.fits'>
				<input type='hidden' name='postcard13' id='postcard13' value='http://hst.esac.esa.int/ehst-sl-server/servlet/data-action?RETRIEVAL_TYPE=POSTCARD&OBSERVATION_ID=w1000403t'/>
				Min: <input type='text' name='min13' value=null id='min13'/>
				Max: <input type='text' name='max13' value=null id='max13'/>
				<label for='13'>
					HST sample2 (normal FITS, no HiPS) taken from the eHST archive. Observation w0ck0101t
				</label>
				http://hst.esac.esa.int/ehst-sl-server/servlet/data-action?RETRIEVAL_TYPE=POSTCARD&OBSERVATION_ID=w1000403t
			</div>
			
			
			
			
			
			<br>
		</div>
		<br>
		<br>
		<br>
		
		<br><br><br>
	

	</div>
</body>
</html>